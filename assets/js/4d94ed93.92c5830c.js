"use strict";(self.webpackChunkcommunity_docs=self.webpackChunkcommunity_docs||[]).push([[181],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var r=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,o=function(e,t){if(null==e)return{};var n,r,o={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var i=r.createContext({}),p=function(e){var t=r.useContext(i),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},c=function(e){var t=p(e.components);return r.createElement(i.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},d=r.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,i=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=p(n),h=o,m=d["".concat(i,".").concat(h)]||d[h]||u[h]||a;return n?r.createElement(m,l(l({ref:t},c),{},{components:n})):r.createElement(m,l({ref:t},c))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,l=new Array(a);l[0]=d;var s={};for(var i in t)hasOwnProperty.call(t,i)&&(s[i]=t[i]);s.originalType=e,s.mdxType="string"==typeof e?e:o,l[1]=s;for(var p=2;p<a;p++)l[p]=n[p];return r.createElement.apply(null,l)}return r.createElement.apply(null,n)}d.displayName="MDXCreateElement"},6212:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>i,contentTitle:()=>l,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>p});var r=n(7462),o=(n(7294),n(3905));const a={},l="Part 5 - Monitoring",s={unversionedId:"the-guide/monitoring",id:"the-guide/monitoring",title:"Part 5 - Monitoring",description:"This guide will show you step by step how to do monitoring on your machine by giving you the instructions to install and configure all the tools needed.",source:"@site/docs/the-guide/5-monitoring.md",sourceDirName:"the-guide",slug:"/the-guide/monitoring",permalink:"/docs/the-guide/monitoring",draft:!1,editUrl:"https://github.com/Luksoverse/community-docs/tree/main/packages/create-docusaurus/templates/shared/docs/the-guide/5-monitoring.md",tags:[],version:"current",sidebarPosition:5,frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Part 4 - LUKSO Network Setup",permalink:"/docs/the-guide/network-setup"},next:{title:"OpenSSH Server Setup",permalink:"/docs/Guides/ssh"}},i={},p=[{value:"Why would you want to do monitoring?",id:"why-would-you-want-to-do-monitoring",level:2},{value:"Overview",id:"overview",level:2},{value:"Step 1 - Node Exporter",id:"step-1---node-exporter",level:2},{value:"1.1 - Add a user",id:"11---add-a-user",level:3},{value:"1.2 - Install",id:"12---install",level:3},{value:"Download Node Exporter",id:"download-node-exporter",level:4},{value:"Extract the archive",id:"extract-the-archive",level:4},{value:"Copy the binary to the following location and set ownership",id:"copy-the-binary-to-the-following-location-and-set-ownership",level:4},{value:"Clean up",id:"clean-up",level:4},{value:"1.3 - Configure the system service",id:"13---configure-the-system-service",level:3},{value:"Create a node explorer configuration file.",id:"create-a-node-explorer-configuration-file",level:4},{value:"Add the following to the file, then save and quit.",id:"add-the-following-to-the-file-then-save-and-quit",level:4},{value:"1.4 - Enable the service",id:"14---enable-the-service",level:3},{value:"Refresh systemd to reflect the changes",id:"refresh-systemd-to-reflect-the-changes",level:4},{value:"Start and check the status of the service",id:"start-and-check-the-status-of-the-service",level:4},{value:"Set Node Exporter to start on boot",id:"set-node-exporter-to-start-on-boot",level:4},{value:"Step 2 - Json Exporter",id:"step-2---json-exporter",level:2},{value:"2.1 -  Prerequisites",id:"21----prerequisites",level:3},{value:"Check <code>go</code> version and install if needed:",id:"check-go-version-and-install-if-needed",level:4},{value:"2.2 - Add user",id:"22---add-user",level:3},{value:"2.3 - Install",id:"23---install",level:3},{value:"2.4 - Configure",id:"24---configure",level:3},{value:"Create directory and set ownership",id:"create-directory-and-set-ownership",level:4},{value:"Setup <code>LYX</code> token price:",id:"setup-lyx-token-price",level:4},{value:"Change ownership of configuration file:",id:"change-ownership-of-configuration-file",level:4},{value:"- Configure service",id:"--configure-service",level:4},{value:"2.5 - Enable service:",id:"25---enable-service",level:3},{value:"Step 3 - Blackbox Exporter",id:"step-3---blackbox-exporter",level:2},{value:"3.1 - Add a user for the service",id:"31---add-a-user-for-the-service",level:3},{value:"3.2 - Install",id:"32---install",level:3},{value:"3.3 - Enable ping permissions",id:"33---enable-ping-permissions",level:3},{value:"3.4 - Configure the exporter",id:"34---configure-the-exporter",level:3},{value:"Create directory and assign ownership",id:"create-directory-and-assign-ownership",level:4},{value:"Open configuration file",id:"open-configuration-file",level:4},{value:"Copy/paste the contents below to the configuration file",id:"copypaste-the-contents-below-to-the-configuration-file",level:4},{value:"Change ownership of configuration file:",id:"change-ownership-of-configuration-file-1",level:4},{value:"3.5 - Configure service",id:"35---configure-service",level:3},{value:"Open the configuration file",id:"open-the-configuration-file",level:4},{value:"Copy/paste the contents below to the configuration file",id:"copypaste-the-contents-below-to-the-configuration-file-1",level:4},{value:"3.6 - Enable the service",id:"36---enable-the-service",level:3},{value:"Step 4 - Prometheus",id:"step-4---prometheus",level:2},{value:"4.1 - Add a user",id:"41---add-a-user",level:3},{value:"4.2 - Install",id:"42---install",level:3},{value:"4.3 - Configure",id:"43---configure",level:3},{value:"Open the configuration file.",id:"open-the-configuration-file-1",level:4},{value:"Copy/paste the contents below to the configuration file.",id:"copypaste-the-contents-below-to-the-configuration-file-2",level:4},{value:"Prepare data directory for prometheus:",id:"prepare-data-directory-for-prometheus",level:4},{value:"4.4 - Open port to access metrics.",id:"44---open-port-to-access-metrics",level:3},{value:"Open the port",id:"open-the-port",level:4},{value:"4.5 - Configure services",id:"45---configure-services",level:3},{value:"Open the configuration file",id:"open-the-configuration-file-2",level:4},{value:"Copy/paste the contents below to the configuration file",id:"copypaste-the-contents-below-to-the-configuration-file-3",level:4},{value:"Step 5 - Grafana",id:"step-5---grafana",level:2},{value:"5.1 - Install",id:"51---install",level:3},{value:"5.2 - Configure Service",id:"52---configure-service",level:3},{value:"Open the configuration file",id:"open-the-configuration-file-3",level:4},{value:"Copy/paste the contents below to the configuration file.",id:"copypaste-the-contents-below-to-the-configuration-file-4",level:4},{value:"5.3 - Enable service",id:"53---enable-service",level:3},{value:"5.4 - Open port to access metrics.",id:"54---open-port-to-access-metrics",level:3},{value:"5.5 - Configure Dashboard",id:"55---configure-dashboard",level:3},{value:"Data Source",id:"data-source",level:4},{value:"Install Dashboard",id:"install-dashboard",level:4},{value:"5.6 - Enable Alerts",id:"56---enable-alerts",level:3}],c={toc:p};function u(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,r.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"part-5---monitoring"},"Part 5 - Monitoring"),(0,o.kt)("p",null,"This guide will show you step by step how to do monitoring on your machine by giving you the instructions to install and configure all the tools needed. "),(0,o.kt)("h2",{id:"why-would-you-want-to-do-monitoring"},"Why would you want to do monitoring?"),(0,o.kt)("p",null,"Here are some good reasons why you might want to do monitoring on your machine:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Information visibility"),": You want to expose and be able to easily see your machine details."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Issue tracking and debugging"),": You want to be able to inspect what happened in the past and see clearly how your machine reacted to some event."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Issue prevention"),": You want to be able to see potential resources exhaustion ahead of time.")),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,"We will install 5 tools with this guide:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/guides/node-exporter/"},"Node Exporter")," - monitors the node machine's performance")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://github.com/prometheus-community/json_exporter"},"JSON Exporter")," - scrapes LUKSO price information from CoinGecko.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://github.com/prometheus/blackbox_exporter"},"Blackbox Exporter")," monitors ping time between the node machine and two DNS servers.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/docs/introduction/overview/"},"Prometheus")," - collects metrics from the node, JSON and Blackbox exporters.")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("p",{parentName:"li"},(0,o.kt)("a",{parentName:"p",href:"https://grafana.com/oss/grafana/"},"Grafana"),' - queries Prometheus for metrics, displays the information on "dashboards," and provides alerts when data is abnormal.'))),(0,o.kt)("p",null,"Connect to your node machine and proceed to the next step."),(0,o.kt)("h2",{id:"step-1---node-exporter"},"Step 1 - Node Exporter"),(0,o.kt)("p",null,"Node_exporter"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"add description")),(0,o.kt)("hr",null),(0,o.kt)("h3",{id:"11---add-a-user"},"1.1 - Add a user"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo adduser --system node_exporter --group --no-create-home\n")),(0,o.kt)("h3",{id:"12---install"},"1.2 - Install"),(0,o.kt)("h4",{id:"download-node-exporter"},"Download Node Exporter"),(0,o.kt)("p",null,"Check ",(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/download/#node_exporter"},"https://prometheus.io/download/#node_exporter")," to make sure 1.3.1 is the latest stable. As of this writing, 1.4.0 was still in pre-release."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"wget https://github.com/prometheus/node_exporter/releases/download/v1.3.1/node_exporter-1.3.1.linux-amd64.tar.gz\n")),(0,o.kt)("h4",{id:"extract-the-archive"},"Extract the archive"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"tar xzvf node_exporter-1.3.1.linux-amd64.tar.gz\n")),(0,o.kt)("h4",{id:"copy-the-binary-to-the-following-location-and-set-ownership"},"Copy the binary to the following location and set ownership"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo cp node_exporter-1.3.1.linux-amd64/node_exporter /usr/local/bin/\nsudo chown node_exporter:node_exporter /usr/local/bin/node_exporter\n")),(0,o.kt)("h4",{id:"clean-up"},"Clean up"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-rm",metastring:"node_exporter-1.3.1.linux-amd64.tar.gz","node_exporter-1.3.1.linux-amd64.tar.gz":!0},"rm -rf node_exporter-1.3.1.linux-amd64\n")),(0,o.kt)("h3",{id:"13---configure-the-system-service"},"1.3 - Configure the system service"),(0,o.kt)("h4",{id:"create-a-node-explorer-configuration-file"},"Create a node explorer configuration file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo nano /etc/systemd/system/node_exporter.service\n")),(0,o.kt)("h4",{id:"add-the-following-to-the-file-then-save-and-quit"},"Add the following to the file, then save and quit."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell",metastring:'title="contents of /etc/systemd/system/node_exporter.service"',title:'"contents',of:!0,'/etc/systemd/system/node_exporter.service"':!0},"[Unit]\nDescription=Node Exporter\n\n[Service]\nType=simple\nRestart=always\nRestartSec=5\nUser=node_exporter\nExecStart=/usr/local/bin/node_exporter\n\n[Install]\nWantedBy=multi-user.target\n")),(0,o.kt)("h3",{id:"14---enable-the-service"},"1.4 - Enable the service"),(0,o.kt)("h4",{id:"refresh-systemd-to-reflect-the-changes"},"Refresh systemd to reflect the changes"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo systemctl daemon-reload\n")),(0,o.kt)("h4",{id:"start-and-check-the-status-of-the-service"},"Start and check the status of the service"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo systemctl start node_exporter\nsudo systemctl is-active node_exporter\n")),(0,o.kt)("p",null,"The output should be"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"active\n")),(0,o.kt)("h4",{id:"set-node-exporter-to-start-on-boot"},"Set Node Exporter to start on boot"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo systemctl enable node_exporter\n")),(0,o.kt)("h2",{id:"step-2---json-exporter"},"Step 2 - Json Exporter"),(0,o.kt)("h3",{id:"21----prerequisites"},"2.1 -  Prerequisites"),(0,o.kt)("h4",{id:"check-go-version-and-install-if-needed"},"Check ",(0,o.kt)("inlineCode",{parentName:"h4"},"go")," version and install if needed:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"go version\n")),(0,o.kt)("p",null,"If it is less than ",(0,o.kt)("inlineCode",{parentName:"p"},"1.17.7")," install the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"wget https://dl.google.com/go/go1.17.7.linux-amd64.tar.gz\nsudo tar -xvf go1.17.7.linux-amd64.tar.gz\nrm go1.17.7.linux-amd64.tar.gz\nsudo mv go /usr/local/go-1.17.7\nsudo ln -sf /usr/local/go-1.17.7/bin/go /usr/bin/go\ngo version\n")),(0,o.kt)("h3",{id:"22---add-user"},"2.2 - Add user"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo adduser --system json_exporter --group --no-create-home\n")),(0,o.kt)("h3",{id:"23---install"},"2.3 - Install"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"cd\ngit clone https://github.com/prometheus-community/json_exporter.git\ncd json_exporter\nmake build\nsudo cp json_exporter /usr/local/bin/\nsudo chown json_exporter:json_exporter /usr/local/bin/json_exporter\ncd\nrm -rf json_exporter\n")),(0,o.kt)("h3",{id:"24---configure"},"2.4 - Configure"),(0,o.kt)("h4",{id:"create-directory-and-set-ownership"},"Create directory and set ownership"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo mkdir /etc/json_exporter\nsudo chown json_exporter:json_exporter /etc/json_exporter\n")),(0,o.kt)("h4",{id:"setup-lyx-token-price"},"Setup ",(0,o.kt)("inlineCode",{parentName:"h4"},"LYX")," token price:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo nano /etc/json_exporter/json_exporter.yml\n")),(0,o.kt)("p",null,"Copy/paste the content of configuration file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},'metrics:\n- name: lyxusd\n  path: "{.lukso-token.usd}"\n  help: Lukso (LYX) price in USD\n')),(0,o.kt)("p",null,"Save and exit"),(0,o.kt)("h4",{id:"change-ownership-of-configuration-file"},"Change ownership of configuration file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo chown json_exporter:json_exporter /etc/json_exporter/json_exporter.yml\n")),(0,o.kt)("h4",{id:"--configure-service"},"- Configure service"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo nano /etc/systemd/system/json_exporter.service\n")),(0,o.kt)("p",null,"Copy/paste the content of configuration file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[Unit]\nDescription=JSON Exporter\n\n[Service]\nType=simple\nRestart=always\nRestartSec=5\nUser=json_exporter\nExecStart=/usr/local/bin/json_exporter --config.file /etc/json_exporter/json_exporter.yml\n\n[Install]\nWantedBy=multi-user.target\n")),(0,o.kt)("h3",{id:"25---enable-service"},"2.5 - Enable service:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo systemctl daemon-reload\nsudo systemctl start json_exporter\nsudo systemctl enable json_exporter\n")),(0,o.kt)("h2",{id:"step-3---blackbox-exporter"},"Step 3 - Blackbox Exporter"),(0,o.kt)("p",null,"Blackbox exporter pings google and cloudflare to track latency."),(0,o.kt)("h3",{id:"31---add-a-user-for-the-service"},"3.1 - Add a user for the service"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo adduser --system blackbox_exporter --group --no-create-home\n")),(0,o.kt)("h3",{id:"32---install"},"3.2 - Install"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"cd\nwget https://github.com/prometheus/blackbox_exporter/releases/download/v0.18.0/blackbox_exporter-0.18.0.linux-amd64.tar.gz\ntar xvzf blackbox_exporter-0.18.0.linux-amd64.tar.gz\nsudo cp blackbox_exporter-0.18.0.linux-amd64/blackbox_exporter /usr/local/bin/\nsudo chown blackbox_exporter:blackbox_exporter /usr/local/bin/blackbox_exporter\nsudo chmod 755 /usr/local/bin/blackbox_exporter\nrm blackbox_exporter-0.18.0.linux-amd64.tar.gz\nrm -rf blackbox_exporter-0.18.0.linux-amd64\n")),(0,o.kt)("h3",{id:"33---enable-ping-permissions"},"3.3 - Enable ping permissions"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo setcap cap_net_raw+ep /usr/local/bin/blackbox_exporter\n")),(0,o.kt)("h3",{id:"34---configure-the-exporter"},"3.4 - Configure the exporter"),(0,o.kt)("h4",{id:"create-directory-and-assign-ownership"},"Create directory and assign ownership"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo mkdir /etc/blackbox_exporter\nsudo chown blackbox_exporter:blackbox_exporter /etc/blackbox_exporter\n")),(0,o.kt)("h4",{id:"open-configuration-file"},"Open configuration file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo nano /etc/blackbox_exporter/blackbox.yml\n")),(0,o.kt)("h4",{id:"copypaste-the-contents-below-to-the-configuration-file"},"Copy/paste the contents below to the configuration file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:"title=/etc/blackbox_exporter/blackbox.yml",title:"/etc/blackbox_exporter/blackbox.yml"},"modules:\n        icmp:\n                prober: icmp\n                timeout: 10s\n                icmp:\n                        preferred_ip_protocol: ipv4\n")),(0,o.kt)("h4",{id:"change-ownership-of-configuration-file-1"},"Change ownership of configuration file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo chown blackbox_exporter:blackbox_exporter /etc/blackbox_exporter/blackbox.yml\n")),(0,o.kt)("h3",{id:"35---configure-service"},"3.5 - Configure service"),(0,o.kt)("h4",{id:"open-the-configuration-file"},"Open the configuration file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo nano /etc/systemd/system/blackbox_exporter.service\n")),(0,o.kt)("h4",{id:"copypaste-the-contents-below-to-the-configuration-file-1"},"Copy/paste the contents below to the configuration file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:"title=/etc/systemd/system/blackbox_exporter.service",title:"/etc/systemd/system/blackbox_exporter.service"},"[Unit]\nDescription=Blackbox Exporter\n\n[Service]\nType=simple\nRestart=always\nRestartSec=5\nUser=blackbox_exporter\nExecStart=/usr/local/bin/blackbox_exporter --config.file /etc/blackbox_exporter/blackbox.yml\n\n[Install]\nWantedBy=multi-user.target\n")),(0,o.kt)("h3",{id:"36---enable-the-service"},"3.6 - Enable the service"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo systemctl daemon-reload\nsudo systemctl start blackbox_exporter\nsudo systemctl enable blackbox_exporter\n")),(0,o.kt)("h2",{id:"step-4---prometheus"},"Step 4 - Prometheus"),(0,o.kt)("h3",{id:"41---add-a-user"},"4.1 - Add a user"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo adduser --system prometheus --group --no-create-home\n")),(0,o.kt)("h3",{id:"42---install"},"4.2 - Install"),(0,o.kt)("p",null,"As of this writing, the current version of Prometheus is 2.37.0 LTS"),(0,o.kt)("p",null,"Confirm the current version for ",(0,o.kt)("inlineCode",{parentName:"p"},"linux-amd64")," ",(0,o.kt)("a",{parentName:"p",href:"https://prometheus.io/download/"},"here")),(0,o.kt)("p",null,"If a newer version exists, replace all occurrences of ",(0,o.kt)("inlineCode",{parentName:"p"},"2.37.0")," with the new version number in the code box below."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"cd\nwget https://github.com/prometheus/prometheus/releases/download/v2.37.0/prometheus-2.37.0.linux-amd64.tar.gz\ntar xzvf prometheus-2.37.0.linux-amd64.tar.gz\ncd prometheus-2.37.0.linux-amd64\nsudo cp promtool /usr/local/bin/\nsudo cp prometheus /usr/local/bin/\nsudo chown root:root /usr/local/bin/promtool /usr/local/bin/prometheus\nsudo chmod 755 /usr/local/bin/promtool /usr/local/bin/prometheus\ncd\nrm prometheus-2.37.0.linux-amd64.tar.gz\nrm -rf prometheus-2.37.0.linux-amd64\n")),(0,o.kt)("h3",{id:"43---configure"},"4.3 - Configure"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo mkdir -p /etc/prometheus/console_libraries /etc/prometheus/consoles /etc/prometheus/files_sd /etc/prometheus/rules /etc/prometheus/rules.d\n")),(0,o.kt)("h4",{id:"open-the-configuration-file-1"},"Open the configuration file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo nano /etc/prometheus/prometheus.yml\n")),(0,o.kt)("h4",{id:"copypaste-the-contents-below-to-the-configuration-file-2"},"Copy/paste the contents below to the configuration file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  - job_name: 'prometheus'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9090']\n  - job_name: 'beacon node'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8080']\n  - job_name: 'node_exporter'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:9100']\n  - job_name: 'validator'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['127.0.0.1:8081']\n  - job_name: 'ping_google'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 8.8.8.8\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: 'ping_cloudflare'\n    metrics_path: /probe\n    params:\n      module: [icmp]\n    static_configs:\n      - targets:\n        - 1.1.1.1\n    relabel_configs:\n      - source_labels: [__address__]\n        target_label: __param_target\n      - source_labels: [__param_target]\n        target_label: instance\n      - target_label: __address__\n        replacement: 127.0.0.1:9115  # The blackbox exporter's real hostname:port.\n  - job_name: json_exporter\n    static_configs:\n    - targets:\n      - 127.0.0.1:7979\n  - job_name: json\n    metrics_path: /probe\n    static_configs:\n    - targets:\n      - https://api.coingecko.com/api/v3/simple/price?ids=lukso-token&vs_currencies=usd\n    relabel_configs:\n    - source_labels: [__address__]\n      target_label: __param_target\n    - source_labels: [__param_target]\n      target_label: instance\n    - target_label: __address__\n      replacement: 127.0.0.1:7979\n")),(0,o.kt)("h4",{id:"prepare-data-directory-for-prometheus"},"Prepare data directory for prometheus:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo chown -R prometheus:prometheus /etc/prometheus\nsudo mkdir /var/lib/prometheus\nsudo chown prometheus:prometheus /var/lib/prometheus\nsudo chmod 755 /var/lib/prometheus\n")),(0,o.kt)("h3",{id:"44---open-port-to-access-metrics"},"4.4 - Open port to access metrics."),(0,o.kt)("p",null,"Opening this port allows access to prometheus metrics in the web browser of you personal computer while connected to the local network. Opening a port in this way poses a slight security risk. For an alternative see ",(0,o.kt)("strong",{parentName:"p"},"coming soon")),(0,o.kt)("h4",{id:"open-the-port"},"Open the port"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo ufw allow 9090/tcp\n")),(0,o.kt)("h3",{id:"45---configure-services"},"4.5 - Configure services"),(0,o.kt)("h4",{id:"open-the-configuration-file-2"},"Open the configuration file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo nano /etc/systemd/system/prometheus.service\n")),(0,o.kt)("h4",{id:"copypaste-the-contents-below-to-the-configuration-file-3"},"Copy/paste the contents below to the configuration file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell=",metastring:"title=/etc/systemd/system/prometheus.service",title:"/etc/systemd/system/prometheus.service"},"[Unit]\nDescription=Prometheus\nWants=network-online.target\nAfter=network-online.target\n\n[Service]\nUser=prometheus\nGroup=prometheus\nType=simple\nRestart=always\nRestartSec=5\nExecStart=/usr/local/bin/prometheus \\\n    --config.file /etc/prometheus/prometheus.yml \\\n    --storage.tsdb.path /var/lib/prometheus/ \\\n    --storage.tsdb.retention.time=31d \\\n    --web.console.templates=/etc/prometheus/consoles \\\n    --web.console.libraries=/etc/prometheus/console_libraries\nExecReload=/bin/kill -HUP $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n")),(0,o.kt)("p",null,"Enable service:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo systemctl daemon-reload\nsudo systemctl start prometheus\nsudo systemctl enable prometheus\n")),(0,o.kt)("h2",{id:"step-5---grafana"},"Step 5 - Grafana"),(0,o.kt)("h3",{id:"51---install"},"5.1 - Install"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},'cd\nsudo apt-get install -y apt-transport-https\nsudo apt-get install -y software-properties-common wget\nwget -q -O - https://packages.grafana.com/gpg.key | sudo apt-key add -\nsudo add-apt-repository "deb https://packages.grafana.com/oss/deb stable main"\nsudo apt-get update\nsudo apt-get install grafana-enterprise\n')),(0,o.kt)("h3",{id:"52---configure-service"},"5.2 - Configure Service"),(0,o.kt)("h4",{id:"open-the-configuration-file-3"},"Open the configuration file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo nano /lib/systemd/system/grafana-server.service\n")),(0,o.kt)("h4",{id:"copypaste-the-contents-below-to-the-configuration-file-4"},"Copy/paste the contents below to the configuration file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[Unit]\nDescription=Grafana instance\nDocumentation=http://docs.grafana.org\nWants=network-online.target\nAfter=network-online.target\nAfter=postgresql.service mariadb.service mysql.service\n\n[Service]\nEnvironmentFile=/etc/default/grafana-server\nUser=grafana\nGroup=grafana\nType=simple\nRestart=on-failure\nWorkingDirectory=/usr/share/grafana\nRuntimeDirectory=grafana\nRuntimeDirectoryMode=0750\nExecStart=/usr/sbin/grafana-server \\\n                            --config=${CONF_FILE} \\\n                            --pidfile=${PID_FILE_DIR}/grafana-server.pid \\\n                            --packaging=deb \\\n                            cfg:default.paths.logs=${LOG_DIR} \\\n                            cfg:default.paths.data=${DATA_DIR} \\\n                            cfg:default.paths.plugins=${PLUGINS_DIR} \\\n                            cfg:default.paths.provisioning=${PROVISIONING_CFG_DIR}\n\n\nLimitNOFILE=10000\nTimeoutStopSec=20\nCapabilityBoundingSet=\nDeviceAllow=\nLockPersonality=true\nMemoryDenyWriteExecute=false\nNoNewPrivileges=true\nPrivateDevices=true\nPrivateTmp=true\nPrivateUsers=true\nProtectClock=true\nProtectControlGroups=true\nProtectHome=true\nProtectHostname=true\nProtectKernelLogs=true\nProtectKernelModules=true\nProtectKernelTunables=true\nProtectProc=invisible\nProtectSystem=full\nRemoveIPC=true\nRestrictAddressFamilies=AF_INET AF_INET6 AF_UNIX\nRestrictNamespaces=true\nRestrictRealtime=true\nRestrictSUIDSGID=true\nSystemCallArchitectures=native\nUMask=0027\n\n[Install]\nAlias=grafana.service\nWantedBy=multi-user.target\n")),(0,o.kt)("h3",{id:"53---enable-service"},"5.3 - Enable service"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo systemctl daemon-reload\nsudo systemctl start grafana-server\nsudo systemctl enable grafana-server\n")),(0,o.kt)("h3",{id:"54---open-port-to-access-metrics"},"5.4 - Open port to access metrics."),(0,o.kt)("p",null,"Opening this port allows access to grafana's dashboard in the web browser of you personal computer while connected to the local network. Opening a port in this way poses a slight security risk. For an alternative see ",(0,o.kt)("strong",{parentName:"p"},"coming soon")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo ufw allow 3000/tcp\n")),(0,o.kt)("h3",{id:"55---configure-dashboard"},"5.5 - Configure Dashboard"),(0,o.kt)("p",null,"Login to grafana by opening a web browser ",(0,o.kt)("inlineCode",{parentName:"p"},"http://<node-ip>:3000"),". Replace ",(0,o.kt)("inlineCode",{parentName:"p"},"<node-ip>")," with IP of your node machine. This is same IP used to ssh."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell=",metastring:'title="Default credentials"',title:'"Default','credentials"':!0},"username: username\npassword: admin\n")),(0,o.kt)("p",null," Set a new secure (long) password when prompted by grafana."),(0,o.kt)("h4",{id:"data-source"},"Data Source"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"On the left-hand menu, hover over the gear menu and click on ",(0,o.kt)("inlineCode",{parentName:"li"},"Data Sources")),(0,o.kt)("li",{parentName:"ol"},"Then click on the Add Data Source button"),(0,o.kt)("li",{parentName:"ol"},"Hover over the Prometheus card on screen, then click on the Select button"),(0,o.kt)("li",{parentName:"ol"},"Enter ",(0,o.kt)("a",{parentName:"li",href:"http://127.0.0.1:9090/"},"http://127.0.0.1:9090/")," into the URL field, then click Save & Test")),(0,o.kt)("h4",{id:"install-dashboard"},"Install Dashboard"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Hover over the plus symbol icon in the left-hand menu, then click on Import"),(0,o.kt)("li",{parentName:"ol"},"Copy and paste the ",(0,o.kt)("a",{parentName:"li",href:"https://github.com/LYXstaker/docs/blob/main/grafana/dashboard.json"},"dashboard")," into the ",(0,o.kt)("inlineCode",{parentName:"li"},"Import via panel json")," text box on the screen"),(0,o.kt)("li",{parentName:"ol"},"Then click the Load button"),(0,o.kt)("li",{parentName:"ol"},"Then click the Import button")),(0,o.kt)("h3",{id:"56---enable-alerts"},"5.6 - Enable Alerts"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"On the left-hand menu, hover over the alarm menu and click on ",(0,o.kt)("inlineCode",{parentName:"li"},"Notification channels")),(0,o.kt)("li",{parentName:"ol"},"Click on ",(0,o.kt)("inlineCode",{parentName:"li"},"New channel")),(0,o.kt)("li",{parentName:"ol"},"Select ",(0,o.kt)("inlineCode",{parentName:"li"},"Type")," and ",(0,o.kt)("a",{parentName:"li",href:"https://grafana.com/docs/grafana/latest/alerting/old-alerting/notifications/"},"configure"))),(0,o.kt)("p",null,"On lukso dashboard:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Scroll down on a dashboard to ",(0,o.kt)("inlineCode",{parentName:"li"},"Alerts")," section"),(0,o.kt)("li",{parentName:"ol"},"Select each alert and click ",(0,o.kt)("inlineCode",{parentName:"li"},"Edit")),(0,o.kt)("li",{parentName:"ol"},"In ",(0,o.kt)("inlineCode",{parentName:"li"},"Alert")," tab, select notifications ",(0,o.kt)("inlineCode",{parentName:"li"},"send to")),(0,o.kt)("li",{parentName:"ol"},"Save and repeat for each alert")),(0,o.kt)("hr",null),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/lykhonis/lukso-node-guide#prometheus"},"Vlad's Guide")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://www.coincashew.com/coins/overview-eth/guide-or-how-to-setup-a-validator-on-eth2-mainnet/part-i-installation/monitoring-your-validator-with-grafana-and-prometheus?q=grafana"},"CoinCashew")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://ethereum.org/en/developers/tutorials/monitoring-geth-with-influxdb-and-grafana/"},"Ethereum.org")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.prylabs.network/docs/prysm-usage/monitoring/grafana-dashboard"},"Prysm Docs")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/remyroy/ethstaker/blob/main/monitoring.md"},"Ethstaker"))))}u.isMDXComponent=!0}}]);