"use strict";(self.webpackChunkcommunity_docs=self.webpackChunkcommunity_docs||[]).push([[2497],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>h});var i=n(7294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,i,o=function(e,t){if(null==e)return{};var n,i,o={},a=Object.keys(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=i.createContext({}),u=function(e){var t=i.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=u(e.components);return i.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},d=i.forwardRef((function(e,t){var n=e.components,o=e.mdxType,a=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=u(n),h=o,m=d["".concat(l,".").concat(h)]||d[h]||c[h]||a;return n?i.createElement(m,r(r({ref:t},p),{},{components:n})):i.createElement(m,r({ref:t},p))}));function h(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var a=n.length,r=new Array(a);r[0]=d;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var u=2;u<a;u++)r[u]=n[u];return i.createElement.apply(null,r)}return i.createElement.apply(null,n)}d.displayName="MDXCreateElement"},1670:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>c,frontMatter:()=>a,metadata:()=>s,toc:()=>u});var i=n(7462),o=(n(7294),n(3905));const a={title:"Part 3 - Settings & Security",sidebar_position:3},r="Part 3 - Settings & Security",s={unversionedId:"Community-Archive/node-guide/settings-security",id:"Community-Archive/node-guide/settings-security",title:"Part 3 - Settings & Security",description:"In part three, we will update various settings to improve security.",source:"@site/docs/Community-Archive/node-guide/3-settings-security.md",sourceDirName:"Community-Archive/node-guide",slug:"/Community-Archive/node-guide/settings-security",permalink:"/docs/Community-Archive/node-guide/settings-security",draft:!1,editUrl:"https://github.com/Luksoverse/community-docs/tree/main/packages/create-docusaurus/templates/shared/docs/Community-Archive/node-guide/3-settings-security.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{title:"Part 3 - Settings & Security",sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Part 2 - Configure SSH",permalink:"/docs/Community-Archive/node-guide/setup-client"},next:{title:"Part 4 - LUKSO Network Setup",permalink:"/docs/Community-Archive/node-guide/network-setup"}},l={},u=[{value:"Step 1 - Configure SSH Server",id:"step-1---configure-ssh-server",level:2},{value:"1.1 - open the configuration file:",id:"11---open-the-configuration-file",level:3},{value:"1.2 - configure the settings",id:"12---configure-the-settings",level:3},{value:"1.3 - validate SSH configuration",id:"13---validate-ssh-configuration",level:3},{value:"1.4 - restart ssh service",id:"14---restart-ssh-service",level:3},{value:"1.5 - test connection",id:"15---test-connection",level:3},{value:"Step 2 - System Update",id:"step-2---system-update",level:2},{value:"2.1 - manually update the system",id:"21---manually-update-the-system",level:3},{value:"2.2 - configure auto-update",id:"22---configure-auto-update",level:3},{value:"Step 3 - Disable Root Access",id:"step-3---disable-root-access",level:2},{value:"Step 4 - Block Unauthorized Access",id:"step-4---block-unauthorized-access",level:2},{value:"4.1 - install fail2ban",id:"41---install-fail2ban",level:3},{value:"4.2 - configure fail2ban",id:"42---configure-fail2ban",level:3},{value:"4.3 - start the service",id:"43---start-the-service",level:3},{value:"Step 5 - Improve SSH Connection (Skip if using Ubuntu Server)",id:"step-5---improve-ssh-connection-skip-if-using-ubuntu-server",level:2},{value:"5.1 - open the configuration file",id:"51---open-the-configuration-file",level:3},{value:"5.2 - modify power setting",id:"52---modify-power-setting",level:3},{value:"5.3 - restart the service:",id:"53---restart-the-service",level:3},{value:"Step 6 - Resize Disk Volume (server install only)",id:"step-6---resize-disk-volume-server-install-only",level:2},{value:"6.1 - check the volume group",id:"61---check-the-volume-group",level:3},{value:"6.2 - extend and resize the volume",id:"62---extend-and-resize-the-volume",level:3},{value:"6.3 - confirm the change",id:"63---confirm-the-change",level:3}],p={toc:u};function c(e){let{components:t,...a}=e;return(0,o.kt)("wrapper",(0,i.Z)({},p,a,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"part-3---settings--security"},"Part 3 - Settings & Security"),(0,o.kt)("p",null,"In part three, we will update various settings to improve security."),(0,o.kt)("h2",{id:"step-1---configure-ssh-server"},"Step 1 - Configure SSH Server"),(0,o.kt)("p",null,"In this step, the SSH server will be configured. The following keywords will be set:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"ChallengeResponseAuthentication no")," - disables keyboard authentication"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"PasswordAuthentication no")," - disables password authentication"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"PermitRootLogin prohibit-password")," - disables password and keyboard-interactive authentication for root"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("inlineCode",{parentName:"li"},"PermitEmptyPasswords no")," - When password authentication is allowed, it specifies whether the server allows login to accounts with empty password strings. The default is no.")),(0,o.kt)("h3",{id:"11---open-the-configuration-file"},"1.1 - open the configuration file:"),(0,o.kt)("p",null,"Establish an SSH connection to your node machine and run the following command."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo nano /etc/ssh/sshd_config\n")),(0,o.kt)("h3",{id:"12---configure-the-settings"},"1.2 - configure the settings"),(0,o.kt)("p",null,"Copy the code block below and paste the keywords to the top of the file."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash",metastring:"title=/etc/ssh/sshd_config",title:"/etc/ssh/sshd_config"},"ChallengeResponseAuthentication no\nPasswordAuthentication no\nPermitRootLogin prohibit-password\nPermitEmptyPasswords no\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Challenge-response protocol in SSHv1 ",(0,o.kt)("inlineCode",{parentName:"p"},"ChallengeResponseAuthentication")," has been upgraded to keyboard-interactive authentication protocol in SSHv2 which looks like the following:"),(0,o.kt)("p",{parentName:"admonition"},(0,o.kt)("inlineCode",{parentName:"p"},"KbdInteractiveAuthentication no"))),(0,o.kt)("p",null,"Save and exit"),(0,o.kt)("h3",{id:"13---validate-ssh-configuration"},"1.3 - validate SSH configuration"),(0,o.kt)("p",null,"Check that the ssdh_config file is valid. If this command results in errors, go back to the last step and double check the changes you made."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo sshd -t\n")),(0,o.kt)("h3",{id:"14---restart-ssh-service"},"1.4 - restart ssh service"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo systemctl restart sshd\n")),(0,o.kt)("p",null,"Close the ssh session"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"exit\n")),(0,o.kt)("h3",{id:"15---test-connection"},"1.5 - test connection"),(0,o.kt)("p",null,"Reconnect to your node machine to verify the settings have not caused any connectivity issues."),(0,o.kt)("h2",{id:"step-2---system-update"},"Step 2 - System Update"),(0,o.kt)("p",null,"It is very important to keep your machine updated. In this step we will run a manual update and the configure the machine to automatically update."),(0,o.kt)("h3",{id:"21---manually-update-the-system"},"2.1 - manually update the system"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo apt-get update -y\nsudo apt dist-upgrade -y\nsudo apt-get autoremove\nsudo apt-get autoclean\n")),(0,o.kt)("h3",{id:"22---configure-auto-update"},"2.2 - configure auto-update"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-shell="},"sudo apt-get install unattended-upgrades\nsudo dpkg-reconfigure -plow unattended-upgrades\n")),(0,o.kt)("h2",{id:"step-3---disable-root-access"},"Step 3 - Disable Root Access"),(0,o.kt)("p",null,"A root access should not be used. Instead, a user should be using sudo to perform privileged operations on a system."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo passwd -l root\n")),(0,o.kt)("h2",{id:"step-4---block-unauthorized-access"},"Step 4 - Block Unauthorized Access"),(0,o.kt)("p",null,"Install Fail2ban to block IP addresses that are attempting to access our node. Fail2ban blocks addresses after a certain number of failed attempts."),(0,o.kt)("h3",{id:"41---install-fail2ban"},"4.1 - install fail2ban"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo apt-get install fail2ban -y\n")),(0,o.kt)("h3",{id:"42---configure-fail2ban"},"4.2 - configure fail2ban"),(0,o.kt)("p",null,"Create a config file to monitor ssh logins"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo nano /etc/fail2ban/jail.local\n")),(0,o.kt)("p",null,"Paste the code below into the text editor. Replace ",(0,o.kt)("inlineCode",{parentName:"p"},"<ssh-port>")," to match your ssh port number."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[sshd]\nenabled=true\nport=<ssh-port>\nfilter=sshd\nlogpath=/var/log/auth.log\nmaxretry=3\nfindtime=300\nbantime=28800\nignoreip=\n")),(0,o.kt)("p",null,"Save changes and close the editor"),(0,o.kt)("h3",{id:"43---start-the-service"},"4.3 - start the service"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo systemctl daemon-reload\nsudo systemctl start fail2ban\nsudo systemctl enable fail2ban\nsudo systemctl status fail2ban\n")),(0,o.kt)("h2",{id:"step-5---improve-ssh-connection-skip-if-using-ubuntu-server"},"Step 5 - Improve SSH Connection (Skip if using Ubuntu Server)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"This step is only required for Ubuntu Desktop installations. If you installed Ubuntu Server, you may skip this step.")),(0,o.kt)("p",null,"WiFi power management may slow down SSH connections. Modifying the config file will disable it."),(0,o.kt)("h3",{id:"51---open-the-configuration-file"},"5.1 - open the configuration file"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo nano /etc/NetworkManager/conf.d/default-wifi-powersave-on.conf\n")),(0,o.kt)("h3",{id:"52---modify-power-setting"},"5.2 - modify power setting"),(0,o.kt)("p",null,"Find the wifi.power setting and change to to match the following:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"[connection]\nwifi.powersave = 2\n")),(0,o.kt)("p",null,"Save changes and close the editor."),(0,o.kt)("h3",{id:"53---restart-the-service"},"5.3 - restart the service:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo systemctl restart NetworkManager\n")),(0,o.kt)("h2",{id:"step-6---resize-disk-volume-server-install-only"},"Step 6 - Resize Disk Volume (server install only)"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"This step is only required for Ubuntu Server installations. If you installed Ubuntu Desktop, you may skip this step.")),(0,o.kt)("p",null,"The default install of Ubuntu Server does not allocate all of the free disk space to the volume group. Follow these steps to check your system and resize the volume group."),(0,o.kt)("h3",{id:"61---check-the-volume-group"},"6.1 - check the volume group"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo vgdisplay\n")),(0,o.kt)("p",null,"Example Output ",(0,o.kt)("img",{alt:"6.1 Example",src:n(8325).Z,width:"1345",height:"846"}),"\nCheck the output:"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Alloc PE / Size")," shows how much space has been allocated to the volume"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Free PE / Size")," shows how much space has not been allocated to the volume."),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"Free PE / Size")," is zero, you can skip the rest of step 6"),(0,o.kt)("p",null,"If ",(0,o.kt)("inlineCode",{parentName:"p"},"Free PE / Size")," has a value, execute the commands below"),(0,o.kt)("h3",{id:"62---extend-and-resize-the-volume"},"6.2 - extend and resize the volume"),(0,o.kt)("p",null,"Execute the two commands below"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo lvextend -l +100%FREE /dev/ubuntu-vg/ubuntu-lv\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo resize2fs /dev/mapper/ubuntu--vg-ubuntu--lv\n")),(0,o.kt)("p",null,"Example Output ",(0,o.kt)("img",{alt:"6-2 Example",src:n(4747).Z,width:"2245",height:"329"})),(0,o.kt)("h3",{id:"63---confirm-the-change"},"6.3 - confirm the change"),(0,o.kt)("p",null,"Check the volume group again"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"sudo vgdisplay\n")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"Free PE / Size")," should now be zero and ",(0,o.kt)("inlineCode",{parentName:"p"},"Alloc PE / Size")," should be the full size of your disk"),(0,o.kt)("p",null,"Example Output ",(0,o.kt)("img",{alt:"6-3 Example",src:n(3074).Z,width:"1238",height:"838"})),(0,o.kt)("hr",null),(0,o.kt)("p",null,"References"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/lykhonis/lukso-node-guide#auto-start"},"Vlad's Guide")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://github.com/metanull-operator/eth2-ubuntu"},"Setup an Eth2 Mainnet Validator System on Ubuntu")),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://man.openbsd.org/sshd_config"},"https://man.openbsd.org/sshd_config"))))}c.isMDXComponent=!0},8325:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/6-1-d01e8a77f8470b5bd55052bb2187e61e.png"},4747:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/6-2-f90970dc2bc3be16fa741370aab9f587.png"},3074:(e,t,n)=>{n.d(t,{Z:()=>i});const i=n.p+"assets/images/6-3-2596e95896de5853e68624270ea79d65.png"}}]);